{{/*
  huge/scripts/private/GetTags
  Construct the tags data from declared/selected scripts to produce the HTML tags

  @author @regisphilibert

  @context Slice/String (.)

  @access private

  @returns Map (complying to https://github.com/theNewDynamic/hugo-module-tnd-tags/blob/main/README.md)

  @uses
     - huge/scripts/private/transform
*/}}
{{ $tags := slice }}

{{/* For future debug setting */}}
{{ $dev := partialCached "huge/config/Get" "dev" "dev"}}
{{ $debug := $dev.debug | default false }}

{{/* Ranging on the selected scripts, apply the js transformation */}}
{{ range $script := partial "huge/scripts/private/GetSelectedScripts" $ }}
  {{ with partial "huge/scripts/private/transform/_" . }}
    {{/* Default assumes this is a script rather than inline */}}
    {{ $tag := dict 
      "name" "script" 
      "attr" (dict 
        "src" .RelPermalink 
        "type" "text/javascript"
        "crossorigin" "anonymous" 
        "defer" "defer"
      )
    }}

    {{/* If inline, we overwrite previously set $tag */}}
    {{ if $script.internal }}
      {{ $tag = dict 
        "name" "script" 
        "inner" .Content
      }}
    {{ end }}

    {{ with $hash := .Data.Integrity }}
      {{ if $script.integrity }}
        {{ $tag = merge $tag (dict 
          "attr" (dict 
            "integrity" $hash
          )
        ) }}
      {{ end }}
    {{ end }}

    {{/* If debug, we add a informative attributes */}}
    {{ if and $debug false }}
      {{ $tag = merge $tag (dict 
        "attr" (dict 
          "data-debug" slice
        )
      ) }}
    {{ end }}
    {{ $tags = $tags | append $tag }}
  {{ end }}
{{ end }}

{{ return $tags }}